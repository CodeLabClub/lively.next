{
  "id": "sketch_9D162709_4BD2_4725_AF15_50E308E9DC21",
  "snapshot": {
    "sketch_9D162709_4BD2_4725_AF15_50E308E9DC21": {
      "rev": 1684601,
      "props": {
        "_tickingScripts": {
          "key": "_tickingScripts",
          "value": []
        },
        "attributeConnections": {
          "key": "attributeConnections",
          "value": [
            {
              "__ref__": true,
              "id": "4D12F199-709E-4D26-BB8A-5EAEABD260BD",
              "rev": 0
            }
          ]
        },
        "name": {
          "key": "name",
          "value": "Sketch"
        },
        "position": {
          "key": "position",
          "value": "__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(358.0,190.0)"
        },
        "origin": {
          "key": "origin",
          "value": "__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(0.0,0.0)"
        },
        "extent": {
          "key": "extent",
          "value": "__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(119.0,87.0)"
        },
        "fill": {
          "key": "fill",
          "value": null
        },
        "submorphs": {
          "key": "submorphs",
          "value": []
        },
        "styleClasses": {
          "key": "styleClasses",
          "value": [
            "Sketch",
            "Canvas",
            "Morph",
            "morph"
          ]
        },
        "canvasExtent": {
          "key": "canvasExtent",
          "value": "__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(119.0,87.0)"
        },
        "_serializedContents": {
          "key": "_serializedContents",
          "value": false
        },
        "strokes": {
          "key": "strokes",
          "value": [
            {
              "__ref__": true,
              "id": "9632B9A0-EBDB-4172-AFD6-C7B7F669675C",
              "rev": 0
            },
            {
              "__ref__": true,
              "id": "0DCF4714-4C22-479E-BAF4-C2C341CB4258",
              "rev": 0
            }
          ]
        },
        "scaleToBounds": {
          "key": "scaleToBounds",
          "value": true
        }
      },
      "lively.serializer-class-info": {
        "className": "Sketch",
        "module": {
          "package": {
            "name": "Sketch",
            "version": "0.1.0"
          },
          "pathInPackage": "index.js",
          "lastChange": 1497387507251,
          "lastSuperclassChange": 1497368348003
        }
      }
    },
    "4D12F199-709E-4D26-BB8A-5EAEABD260BD": {
      "rev": 0,
      "props": {
        "doNotSerialize": {
          "key": "doNotSerialize",
          "value": [
            "isActive",
            "converter",
            "updater"
          ]
        },
        "sourceObj": {
          "key": "sourceObj",
          "value": {
            "__ref__": true,
            "id": "sketch_9D162709_4BD2_4725_AF15_50E308E9DC21",
            "rev": 1684601
          }
        },
        "sourceAttrName": {
          "key": "sourceAttrName",
          "value": "extent"
        },
        "targetObj": {
          "key": "targetObj",
          "value": {
            "__ref__": true,
            "id": "sketch_9D162709_4BD2_4725_AF15_50E308E9DC21",
            "rev": 1684601
          }
        },
        "targetMethodName": {
          "key": "targetMethodName",
          "value": "onExtentChanged"
        },
        "varMapping": {
          "key": "varMapping",
          "value": {
            "__ref__": true,
            "id": "AE2788B4-047E-4DF4-B707-699B42BEBD74",
            "rev": 0
          }
        },
        "garbageCollect": {
          "key": "garbageCollect",
          "value": true
        },
        "signalOnAssignment": {
          "key": "signalOnAssignment",
          "value": true
        }
      },
      "lively.serializer-class-info": {
        "className": "AttributeConnection",
        "module": {
          "package": {
            "name": "lively.bindings",
            "version": "0.1.1"
          },
          "pathInPackage": "index.js",
          "lastChange": 1497362535674,
          "lastSuperclassChange": 0
        }
      }
    },
    "AE2788B4-047E-4DF4-B707-699B42BEBD74": {
      "rev": 0,
      "props": {
        "source": {
          "key": "source",
          "value": {
            "__ref__": true,
            "id": "sketch_9D162709_4BD2_4725_AF15_50E308E9DC21",
            "rev": 1684601
          }
        },
        "target": {
          "key": "target",
          "value": {
            "__ref__": true,
            "id": "sketch_9D162709_4BD2_4725_AF15_50E308E9DC21",
            "rev": 1684601
          }
        }
      }
    },
    "9632B9A0-EBDB-4172-AFD6-C7B7F669675C": {
      "rev": 0,
      "props": {
        "color": {
          "key": "color",
          "value": "__lv_expr__:{Color}:lively.graphics/color.js:Color.rgb(0,0,0)"
        },
        "width": {
          "key": "width",
          "value": 2
        },
        "vertices": {
          "key": "vertices",
          "value": [
            79,
            9,
            77,
            8,
            73,
            7,
            67,
            6,
            59,
            6,
            40,
            6,
            31,
            9,
            22,
            15,
            17,
            21,
            12,
            28,
            9,
            35,
            7,
            43,
            6,
            56,
            7,
            65,
            13,
            73,
            19,
            79,
            27,
            84,
            38,
            85,
            49,
            85,
            61,
            81,
            96,
            53,
            105,
            45,
            108,
            40,
            110,
            34,
            111,
            27,
            111,
            23,
            94,
            13,
            88,
            12,
            85,
            11,
            83,
            11,
            82,
            11
          ]
        }
      }
    },
    "0DCF4714-4C22-479E-BAF4-C2C341CB4258": {
      "rev": 0,
      "props": {
        "color": {
          "key": "color",
          "value": "__lv_expr__:{Color}:lively.graphics/color.js:Color.rgb(236,168,31)"
        },
        "width": {
          "key": "width",
          "value": 32
        },
        "vertices": {
          "key": "vertices",
          "value": [
            73,
            17,
            69,
            17,
            68,
            17,
            66,
            17,
            63,
            17,
            61,
            17,
            58,
            17,
            56,
            17,
            52,
            17,
            50,
            17,
            48,
            17,
            47,
            18,
            46,
            18,
            44,
            20,
            43,
            22,
            40,
            27,
            39,
            29,
            38,
            30,
            37,
            31,
            37,
            32,
            37,
            33,
            36,
            34,
            35,
            36,
            34,
            38,
            33,
            40,
            32,
            42,
            31,
            47,
            31,
            50,
            31,
            52,
            31,
            54,
            31,
            55,
            31,
            57,
            31,
            58,
            31,
            61,
            32,
            61,
            34,
            62,
            35,
            62,
            37,
            62,
            39,
            62,
            46,
            62,
            49,
            62,
            52,
            62,
            55,
            62,
            58,
            61,
            61,
            61,
            64,
            61,
            67,
            61,
            75,
            61,
            77,
            60,
            81,
            59,
            83,
            57,
            86,
            55,
            93,
            52,
            95,
            51,
            97,
            50,
            99,
            49,
            100,
            48,
            101,
            47,
            102,
            46,
            102,
            44,
            102,
            43,
            102,
            41,
            102,
            39,
            99,
            37,
            93,
            32,
            90,
            31,
            88,
            30,
            87,
            30,
            86,
            30,
            86,
            29,
            85,
            29,
            82,
            29,
            77,
            30,
            74,
            32,
            70,
            34,
            67,
            36,
            64,
            37,
            61,
            37,
            60,
            38,
            59,
            39,
            56,
            41,
            53,
            42,
            49,
            45,
            47,
            46,
            45,
            47,
            44,
            49,
            43,
            49,
            42,
            49,
            41,
            50,
            39,
            50,
            38,
            51,
            37,
            51,
            36,
            52,
            34,
            52,
            31,
            53,
            28,
            53,
            26,
            53,
            24,
            53,
            23,
            52,
            22,
            50,
            21,
            47,
            21,
            44,
            21,
            42,
            21,
            41,
            21,
            39,
            21,
            37,
            21,
            35,
            21,
            36,
            21,
            37,
            19,
            40,
            18,
            43,
            18,
            47,
            17,
            49,
            17,
            57,
            18,
            59,
            19,
            60,
            20,
            60,
            20,
            61,
            20,
            62,
            22,
            63,
            23,
            63,
            25,
            63,
            26,
            64,
            29,
            64,
            30,
            64,
            33,
            64,
            36,
            64,
            41,
            64,
            43,
            64,
            44,
            63,
            47,
            63,
            48,
            62,
            49,
            61,
            51,
            59,
            53,
            55,
            58,
            47,
            59,
            45,
            60,
            43,
            60,
            42,
            60,
            42,
            59,
            42,
            57,
            40,
            53,
            39,
            49,
            38,
            44,
            38,
            41,
            38,
            38,
            37,
            36,
            37,
            34,
            36,
            29,
            36,
            28,
            35,
            27,
            34,
            25,
            34,
            24,
            31,
            24,
            30,
            23,
            28,
            23,
            27,
            23,
            26,
            23,
            25,
            25,
            22,
            26,
            21,
            28,
            20,
            28,
            19,
            29,
            19,
            29,
            18,
            30,
            18,
            31,
            18,
            32,
            19,
            33,
            20,
            34,
            21,
            35,
            23,
            37,
            24
          ]
        }
      }
    }
  },
  "requiredVersion": "~0.1",
  "packages": {
    "local://lively-object-modules/": {
      "Sketch": {
        "package.json": "{\n  \"name\": \"Sketch\",\n  \"version\": \"0.1.0\",\n  \"lively\": {\n    \"isObjectPackage\": true\n  }\n}",
        "index.js": "import { Canvas } from \"lively.morphic/components/canvas.js\";\nimport { show } from \"lively.morphic/index.js\";\nimport { loadObjectFromPartsbinFolder } from \"lively.morphic/partsbin.js\";\nimport { rect, pt } from \"lively.graphics/index.js\";\n\n\nexport default class Sketch extends Canvas {\n  static get properties() {\n    return {\n      strokes: {defaultValue: []},\n      preserveContents: {defaultValue: false},\n      scaleToBounds: {defaultValue: false},\n    }\n  }\n\n  get isSketch() { return true; }\n\n  restoreContent(old_canvas) {\n    this.redraw();\n  }\n\n  redraw() {\n    const ctx = this.context;\n    if (!ctx) return;\n    this.clear();\n    ctx.save();\n    if (this.scaleToBounds) {\n      let {width: sw, height: sh} = this.strokeBounds();\n      let {width: cw, height: ch} = this._canvas;\n      ctx.scale(cw / sw, ch / sh);\n    }\n    ctx.globalCompositeOperation = \"darken\";\n    ctx.lineJoin = \"round\";\n    ctx.lineCap = \"round\";\n    for (let stroke of this.strokes) {\n      const {color, width, vertices} = stroke;\n      ctx.beginPath();\n      if (width) ctx.lineWidth = width;\n      if (color) ctx.strokeStyle = color;\n      let [x, y] = vertices;\n      ctx.moveTo(x, y);\n      for (let i = 0; i < vertices.length; i += 2) {\n        x = vertices[i],\n        y = vertices[i + 1];\n        ctx.lineTo(x, y);\n      }\n      ctx.stroke();\n    }\n    ctx.restore();\n  }\n\n  strokeBounds() {\n    let minx = 1000000000,\n        maxx = -1000000000,\n        miny = 1000000000,\n        maxy = -1000000000;\n    for (let stroke of this.strokes) {\n      const {width, vertices} = stroke;\n      const w = width / 2;\n      for (let i = 0; i < vertices.length; i += 2) {\n        const x = vertices[i];\n        const y = vertices[i + 1];\n        if (x - w < minx) minx = x - w;\n        if (x + w > maxx) maxx = x + w;\n        if (y - w < miny) miny = y - w;\n        if (y + w > maxy) maxy = y + w;\n      }\n    }\n    return rect(minx, miny, maxx - minx, maxy - miny).expandBy(1);\n  }\n  \n  moveStrokes({x, y}) {\n    for (let stroke of this.strokes) {\n      const {vertices} = stroke;\n      for (let i = 0; i < vertices.length; i += 2) {\n        vertices[i    ] += x;\n        vertices[i + 1] += y;\n      }\n    }    \n  }\n\n  trimNonTransparent(){\n    let bounds = this.strokeBounds(),\n        offset = bounds.topLeft(),\n        extent = bounds.extent();\n    if (!offset.equals(pt(0,0))) {\n      this.moveStrokes(offset.negated());\n      this.position = this.position.addPt(offset);\n    }\n    if (!extent.equals(this.extent)) {\n      this.extent = extent;     // causes redraw\n    } else {\n      this.redraw();\n    }\n  }\n\n  onExtentChanged() {\n    this.__canvas_init__ = () => this.redraw();\n  }\n\n  renderPreview(opts) {\n    this.__canvas_init__ = () => this.redraw();\n    return super.renderPreview(opts);\n  }\n  \n  menuItems() {\n    const items = super.menuItems();\n    items.push(['Reset bounds', () => this.trimNonTransparent()]);\n    items.push(['Open sketching palette', () => this.edit()]);\n    return items;\n  }\n\n  edit() {\n    this.aquirePalette().then((palette) => palette.edit(this));\n  }\n\n  async aquirePalette() {\n    let palette = this.world().submorphs.find((m) => m.isSketchingPalette);\n    if (palette) {\n      palette.uncollapse();\n    } else {\n      palette = await loadObjectFromPartsbinFolder(\"SketchingPalette\");\n      palette.openInWorld();\n    }\n    return palette;\n  }\n}\n\n"
      }
    }
  },
  "preview": "data:image/png;base64,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"
}