<html>
<body>
  <ol id="log"></ol>
  <script src="../node_modules/systemjs/dist/system.src.js"></script>
  <script src="../index-browser.js"></script>
  <script>

function print(val) {
  return JSON.stringify(val, null, 2);
}
function show(msg) {
  console.log(msg);
  var stringified = typeof msg === "object" ? print(msg) : String(msg);
  document.querySelector("#log").insertAdjacentHTML("beforeend", '<li><pre>' + stringified + '</li>');
}

var vmPath = document.location.pathname.split("/").slice(0,-2).join("/");
var testEval = "Object.keys(currentSystem().__lively_vm__.loadedModules)";

lively.vm.bootstrap(vmPath)
  .then(vm => {
    show("lively.vm bootstrapped...!");
    return vm.es6.runEval(testEval, {targetModule: "lively.vm/lib/es6-interface.js"})
  })
  .then(result => {
    if (result.error || result.value instanceof Error) throw (result.error || result.value);
    show(testEval + " => " + print(result.value));
    show("DONE")
  })
  .catch(err => {
    if (err.originalErr) err = err.originalErr;
    show(err.stack);
    console.error(err.stack);
  });

  </script>
</body>
</html>
