(function runtimeDefinition(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;"object"!=typeof e.lively&&(e.lively={});var t={},r={};if(e.lively.FreezerRuntime){let[r,i,s]=(void 0).split(".").map(Number),[l,n,o]=e.lively.FreezerRuntime.version.split(".").map(Number),u=!1;if((isNaN(l)||!isNaN(r)&&r>l)&&(u=!0),!u&&(isNaN(n)||!isNaN(i)&&i>n)&&(u=!0),!u&&(isNaN(o)||!isNaN(s)&&s>o)&&(u=!0),!u)return;t=e.lively.FreezerRuntime.registry}r["@lively-env"]={executed:!0,options:{},moduleEnv(e){const t=System.get(e)||System.fetchStandaloneFor(e)||System.get(e+"index.js");return{recorder:t.recorder||t.exports}}},r["@system-env"]={executed:!0,browser:!0},e.lively.FreezerRuntime={global:window,version:void 0,registry:t,globalModules:r,get(e){return e&&e.startsWith("@")?this.globalModules[e]:this.registry[e]},set(e,t){return this.registry[e]=t},add(e,t=[],r={},i=!1){let s={id:e,dependencies:t,executed:i,exports:r,execute:function(){},setters:[],package:function(){}};return this.set(e,s),s},decanonicalize(t){if(e.lively.FreezerRuntime.globalModules[t])return t;let r=t.replace("lively-object-modules/","").replace(e.System.baseURL,"");if(!(r=r.includes("local://")?r:"local://"+r).match(/\@\S*\//)){let[t,...i]=r.replace("local://","").split("/"),s=Object.keys(e.lively.FreezerRuntime.registry).find(e=>e.replace("local://","").split("@")[0]==t),l=s&&s.match(/\@[\d|\.|\-|\~]*\//)[0];r="local://"+t+l+i}return r},loadObjectFromPartsbinFolder:t=>e.lively.resources.resource(origin+dynamicPartsDir).join(t+".json").readJson().then(t=>e.lively.morphic.loadMorphFromSnapshot(t,{onDeserializationStart:!1,migrations:[]})),fetchStandaloneFor(e){for(let t in this.globalModules)if(e.match(t.replace("local://","").replace(/\@.*\//,"/").replace("/index.js","")))return this.globalModules[t]},resolveSync(t,r){let i=this.get(t);if(i)return i;if(!t.includes("/")){let r=t.split("."),i=e;for(;i&&r.length;)i=i[r.shift()];if(i)return{executed:!0,exports:i,dependencies:[]}}let s=this.get(this.decanonicalize(t,r));if(s)return{executed:!0,exports:s,dependencies:[]};if(i=this.fetchStandaloneFor(t))return i;throw new Error(`Module ${t} cannot be found in lively.freezer bundle!`)},register(e,t,r){let i=this.add(e,t),s=r((e,t)=>{if("string"==typeof e)i.exports[e]=t;else for(let t in e)i.exports[t]=e[t]});return i.execute=s.execute,i.setters=s.setters,i},updateImports(e){if(e.dependencies)for(let t=0;t<e.dependencies.length;t++){let r=e.dependencies[t],i="@empty"!=r&&this.resolveSync(r,e.id);i&&e.setters[t](i.exports)}},updateDependent(e,t){for(let r=0;r<t.dependencies.length;r++){let i=t.dependencies[r];"@empty"!=i&&e==this.resolveSync(i,t.id)&&t.setters[r](e.exports)}},computeUniqDepGraphs(e){var t=[],r={},i={"@empty":[]},s={"@empty":[]};if(!e){let t={},r=lively.FreezerRuntime.registry;for(let e in r)t[e]=r[e].dependencies;e=t}for(let o in e){r.hasOwnProperty(o)||(r[o]=!0,t.push(o));var l=e[o],n={};if(l){i[o]=[];for(let e of l){if(n.hasOwnProperty(e)||o===e)continue;let l=s[e]||(s[e]=[]);l.includes(o)||l.push(o),n[e]=!0,i[o].push(e),r.hasOwnProperty(e)||(r[e]=!0,t.push(e))}}}return{uniqDepGraph:i,inverseDepGraph:s,dependencies:t}},sortForLoad(e){var t,{dependencies:r,uniqDepGraph:i,inverseDepGraph:s}=this.computeUniqDepGraphs(),l=[],n={};function o(e){return e.split("/")[0]}function u(e){return(i[t]||[]).filter(e=>!a(e)).map(e=>o(e))}function a(e){return"@empty"==e||!!lively.FreezerRuntime.globalModules[e]}function p(e,t,r=new Set){return e==t||!!i[e]&&(i[e].includes(t)||i[e].some(e=>!r.has(e)&&p(e,t,new Set([...r,...i[e]]))))}for(let e=r.length;e--;){if(a(t=r[e]))l.push(t);else{let e=o(t);if(!p(e+"/index.js",t))continue;n[e]?(n[e].modules.push(t),n[e].deps.push(...u())):n[e]={modules:[t],deps:u()}}r.splice(e,1)}let d=r;for(var c in n)n[c].deps=new Set(n[c].deps.filter(e=>e!=c));function h(e,...t){return e.filter(e=>"@empty"!=e&&!e.includes("/index.js")).every(e=>t.some(t=>t.includes(e)))}r=Object.keys(n);let f=[];for(;r.length;){for(var g=1/0,y=[],m=[],v=[],x=0;x<r.length;x++){let e=[...n[b=r[x]].deps];e.length>g||(e.length===g&&h(e,f,y)?(y.push(b),m.push(x)):(g=e.length,h(e,f,y)&&(y=[b],m=[x])))}if(0==y.length)break;for(x=m.length;x--;){var b=r[m[x]];r.splice(m[x],1)}f.push(...y)}let S=r;var z;for(var F of f){for(z=n[F].modules;z.length;){for(g=1/0,y=[],m=[],v=[],x=0;x<z.length;x++){b=z[x];let e=i[b]||[];e.length>g||(e.length===g&&h(e,l,y)?(y.push(b),m.push(x),v.push(...s[b]||[])):(g=e.length,h(e,l,y)&&(y=[b],m=[x],v=(s[b]||[]).slice())))}if(0==y.length)break;for(x=m.length;x--;){s[b=z[m[x]]]=[],z.splice(m[x],1)}for(var b of v)i[b]=i[b].filter(e=>!y.includes(e));l.push(...y)}l.push(...z)}for(var F of(r=d,S))r.push(...n[F].modules);for(;r.length;){for(g=1/0,y=[],m=[],v=[],x=0;x<r.length;x++){b=r[x];let e=i[b]||[];e.length>g||(e.length===g&&h(e,l,y)?(y.push(b),m.push(x),v.push(...s[b]||[])):(g=e.length,h(e,l,y)&&(y=[b],m=[x],v=(s[b]||[]).slice())))}if(0==y.length)break;for(x=m.length;x--;){s[b=r[m[x]]]=[],r.splice(m[x],1)}for(var b of v)i[b]=i[b].filter(e=>!y.includes(e));l.push(...y)}let w=[];for(let e in l)(i[e]||[]).length&&w.push(e);return console.log("async modules due to preserved module structures: ",[...w,...r]),[l,r]},initializeClass(t,r,i=[],s=[],l={},n,o){if(void 0===r)throw Error("Superclass can not be undefined!");return e.System.initializeClass._get=e.lively.classes.runtime.initializeClass._get,e.System.initializeClass._set=e.lively.classes.runtime.initializeClass._set,lively.classes.runtime.initializeClass(t,r,i,s,l,n,o)},load(e){let[t,r]=this.sortForLoad(e),{inverseDepGraph:i}=this.computeUniqDepGraphs(),s=[...t,...r],l=e=>{(i[e.id]||[]).forEach(t=>{let r=this.get(t);try{this.updateDependent(e,r)}catch(t){e.executed=!1}})},n=e=>{for(let t of e){let e=this.get(t);if(e&&!e.executed){e.executed=!0;try{this.updateImports(e),e.execute()}catch(t){e.executed=!1}l(e)}}};for(let e=0;s.some(e=>this.get(e)&&!this.get(e).executed)&&e<5;e++)n(s);return this.get(e).exports}},e.System=e.lively.FreezerRuntime})()