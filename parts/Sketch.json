{
  "id": "sketch_7A2F0B94_BA29_4084_A3CA_B618D2B39ED8",
  "snapshot": {
    "sketch_7A2F0B94_BA29_4084_A3CA_B618D2B39ED8": {
      "rev": 382235,
      "props": {
        "_tickingScripts": {
          "key": "_tickingScripts",
          "value": []
        },
        "attributeConnections": {
          "key": "attributeConnections",
          "value": [
            {
              "__ref__": true,
              "id": "4CEA2C43-F51B-4A45-8546-E0243DE23B5E",
              "rev": 0
            }
          ]
        },
        "name": {
          "key": "name",
          "value": "Sketch"
        },
        "position": {
          "key": "position",
          "value": "__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(76.0,253.0)"
        },
        "origin": {
          "key": "origin",
          "value": "__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(0.0,0.0)"
        },
        "extent": {
          "key": "extent",
          "value": "__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(116.0,114.0)"
        },
        "fill": {
          "key": "fill",
          "value": null
        },
        "submorphs": {
          "key": "submorphs",
          "value": []
        },
        "scroll": {
          "key": "scroll",
          "value": "__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(0.0,0.0)"
        },
        "scrollbarOffset": {
          "key": "scrollbarOffset",
          "value": "__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(15.0,15.0)"
        },
        "styleClasses": {
          "key": "styleClasses",
          "value": [
            "Sketch",
            "Canvas",
            "Morph",
            "morph"
          ]
        },
        "canvasExtent": {
          "key": "canvasExtent",
          "value": "__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(116.0,114.0)"
        },
        "_serializedContents": {
          "key": "_serializedContents",
          "value": false
        },
        "strokes": {
          "key": "strokes",
          "value": [
            {
              "__ref__": true,
              "id": "EEF20607-540E-432D-A950-C997D2302B5B",
              "rev": 0
            },
            {
              "__ref__": true,
              "id": "A8963F22-2FE6-4C66-9534-C2B5FA2A9028",
              "rev": 0
            }
          ]
        }
      },
      "lively.serializer-class-info": {
        "className": "Sketch",
        "module": {
          "package": {
            "name": "Sketch",
            "version": "0.1.0"
          },
          "pathInPackage": "index.js",
          "lastChange": 1497368686925,
          "lastSuperclassChange": 1497368348003
        }
      }
    },
    "4CEA2C43-F51B-4A45-8546-E0243DE23B5E": {
      "rev": 0,
      "props": {
        "doNotSerialize": {
          "key": "doNotSerialize",
          "value": [
            "isActive",
            "converter",
            "updater"
          ]
        },
        "sourceObj": {
          "key": "sourceObj",
          "value": {
            "__ref__": true,
            "id": "sketch_7A2F0B94_BA29_4084_A3CA_B618D2B39ED8",
            "rev": 382235
          }
        },
        "sourceAttrName": {
          "key": "sourceAttrName",
          "value": "extent"
        },
        "targetObj": {
          "key": "targetObj",
          "value": {
            "__ref__": true,
            "id": "sketch_7A2F0B94_BA29_4084_A3CA_B618D2B39ED8",
            "rev": 382235
          }
        },
        "targetMethodName": {
          "key": "targetMethodName",
          "value": "onExtentChanged"
        },
        "varMapping": {
          "key": "varMapping",
          "value": {
            "__ref__": true,
            "id": "BDF2839A-6780-48B5-8760-E9B9451C6C75",
            "rev": 0
          }
        },
        "garbageCollect": {
          "key": "garbageCollect",
          "value": true
        },
        "signalOnAssignment": {
          "key": "signalOnAssignment",
          "value": true
        }
      },
      "lively.serializer-class-info": {
        "className": "AttributeConnection",
        "module": {
          "package": {
            "name": "lively.bindings",
            "version": "0.1.1"
          },
          "pathInPackage": "index.js",
          "lastChange": 1497362535674,
          "lastSuperclassChange": 0
        }
      }
    },
    "BDF2839A-6780-48B5-8760-E9B9451C6C75": {
      "rev": 0,
      "props": {
        "source": {
          "key": "source",
          "value": {
            "__ref__": true,
            "id": "sketch_7A2F0B94_BA29_4084_A3CA_B618D2B39ED8",
            "rev": 382235
          }
        },
        "target": {
          "key": "target",
          "value": {
            "__ref__": true,
            "id": "sketch_7A2F0B94_BA29_4084_A3CA_B618D2B39ED8",
            "rev": 382235
          }
        }
      }
    },
    "EEF20607-540E-432D-A950-C997D2302B5B": {
      "rev": 0,
      "props": {
        "color": {
          "key": "color",
          "value": "__lv_expr__:{Color}:lively.graphics/color.js:Color.rgb(0,0,0)"
        },
        "width": {
          "key": "width",
          "value": 2
        },
        "vertices": {
          "key": "vertices",
          "value": [
            44,
            12,
            42,
            12,
            41,
            12,
            35,
            12,
            31,
            12,
            28,
            12,
            26,
            12,
            24,
            12,
            21,
            13,
            17,
            20,
            11,
            30,
            10,
            34,
            9,
            40,
            6,
            46,
            6,
            50,
            6,
            55,
            6,
            59,
            6,
            68,
            6,
            71,
            7,
            74,
            10,
            78,
            13,
            81,
            18,
            84,
            30,
            89,
            34,
            90,
            38,
            90,
            43,
            92,
            51,
            92,
            55,
            92,
            65,
            89,
            68,
            87,
            72,
            85,
            76,
            83,
            78,
            81,
            81,
            78,
            84,
            75,
            88,
            61,
            89,
            57,
            91,
            53,
            91,
            49,
            91,
            45,
            91,
            40,
            91,
            27,
            89,
            24,
            85,
            17,
            82,
            15,
            79,
            12,
            72,
            6,
            69,
            4,
            66,
            3,
            63,
            3,
            58,
            2,
            55,
            2,
            46,
            2,
            45,
            2,
            44,
            2,
            42,
            2,
            41,
            2,
            41,
            3
          ]
        }
      }
    },
    "A8963F22-2FE6-4C66-9534-C2B5FA2A9028": {
      "rev": 0,
      "props": {
        "color": {
          "key": "color",
          "value": "__lv_expr__:{Color}:lively.graphics/color.js:Color.rgb(236,168,31)"
        },
        "width": {
          "key": "width",
          "value": 16
        },
        "vertices": {
          "key": "vertices",
          "value": [
            64,
            15,
            63,
            15,
            61,
            15,
            56,
            15,
            52,
            15,
            38,
            15,
            33,
            16,
            27,
            21,
            22,
            27,
            17,
            33,
            14,
            40,
            11,
            49,
            9,
            60,
            9,
            71,
            14,
            74,
            20,
            77,
            31,
            78,
            41,
            78,
            61,
            69,
            63,
            63,
            64,
            56,
            63,
            44,
            59,
            40,
            53,
            36,
            31,
            36,
            26,
            39,
            24,
            42,
            23,
            48,
            23,
            55,
            26,
            60,
            53,
            73,
            62,
            72,
            69,
            65,
            74,
            55,
            77,
            47,
            78,
            37,
            67,
            25,
            55,
            27,
            50,
            34,
            47,
            43,
            45,
            48,
            45,
            56,
            47,
            66,
            49,
            67,
            52,
            67,
            56,
            65,
            57,
            62,
            50,
            54,
            45,
            56,
            42,
            61,
            39,
            66,
            38,
            71,
            38,
            76,
            38,
            78,
            42,
            80,
            46,
            80,
            47,
            80,
            47,
            78,
            47,
            77,
            46,
            77,
            42,
            77,
            41,
            78,
            40,
            78,
            40,
            80,
            40,
            80,
            43,
            81,
            45,
            81,
            46,
            81,
            47,
            81,
            47,
            82,
            48,
            82,
            49,
            83,
            51,
            83,
            52,
            83,
            54,
            83,
            55,
            83,
            62,
            80,
            64,
            78,
            65,
            76,
            66,
            75,
            68,
            73,
            69,
            71,
            70,
            69,
            71,
            67,
            73,
            60,
            74,
            56,
            75,
            54,
            75,
            53,
            75,
            51,
            76,
            44,
            76,
            42,
            76,
            40,
            76,
            36,
            76,
            34,
            76,
            31,
            76,
            30,
            74,
            27,
            72,
            24,
            72,
            23,
            71,
            22,
            70,
            22,
            69,
            19,
            69,
            18,
            70,
            18,
            71,
            18,
            73,
            18,
            74,
            18,
            75,
            18,
            76,
            18,
            77,
            19,
            78,
            20,
            78,
            22,
            79,
            22,
            79,
            24,
            79,
            25,
            80,
            26,
            80,
            27,
            80,
            29,
            81,
            33,
            81,
            36,
            81,
            38,
            81,
            41,
            81,
            46,
            81,
            49,
            81,
            53,
            81,
            55,
            81,
            57,
            80,
            59,
            79,
            61,
            78,
            63,
            77,
            64,
            76,
            65,
            75,
            67,
            75,
            68,
            74,
            69,
            73,
            71,
            72,
            73,
            71,
            74,
            71,
            75,
            69,
            77,
            69,
            78,
            67,
            79,
            64,
            80,
            63,
            80,
            61,
            80,
            59,
            80,
            56,
            80,
            55,
            80,
            52,
            80,
            51,
            80,
            50,
            80,
            48,
            80,
            43,
            75,
            43,
            73,
            41,
            68,
            40,
            61,
            39,
            56,
            39,
            50,
            38,
            47,
            38,
            44,
            38,
            41,
            38,
            39,
            38,
            37,
            38,
            36,
            38,
            34,
            38,
            33,
            38,
            31,
            38,
            30,
            38,
            29,
            38,
            28,
            38,
            27,
            37,
            25,
            37,
            24,
            37,
            22,
            37,
            21,
            37,
            20,
            38,
            20,
            39,
            19,
            40,
            18,
            41,
            17,
            44,
            17,
            46,
            17,
            48,
            17,
            50,
            17,
            51,
            17,
            53,
            17,
            57,
            18,
            58,
            19,
            59,
            19,
            59,
            20,
            60,
            21,
            62,
            22,
            61,
            22,
            60,
            22,
            59,
            22,
            55,
            23,
            52,
            27,
            46,
            31,
            42,
            35,
            34,
            42,
            32,
            44,
            31,
            46,
            30,
            47,
            30,
            49,
            30,
            50,
            30,
            52,
            30,
            53,
            30,
            54,
            30,
            55,
            31,
            55,
            32,
            56,
            32,
            57,
            32,
            58,
            32,
            59,
            32,
            60,
            33,
            60,
            33,
            61,
            34,
            61,
            34,
            61,
            35,
            61,
            37,
            61,
            40,
            61,
            42,
            61,
            43,
            61,
            43,
            61,
            43,
            62,
            42,
            63,
            39,
            64,
            35,
            65,
            33,
            65,
            31,
            66,
            29,
            66,
            27,
            66,
            26,
            66,
            25,
            65,
            24,
            65,
            23,
            65,
            22,
            64,
            21,
            63,
            20,
            63,
            18,
            60,
            18,
            59
          ]
        }
      }
    }
  },
  "requiredVersion": "~0.1",
  "packages": {
    "local://lively-object-modules/": {
      "Sketch": {
        "package.json": "{\n  \"name\": \"Sketch\",\n  \"version\": \"0.1.0\",\n  \"lively\": {\n    \"isObjectPackage\": true\n  }\n}",
        "index.js": "import { Canvas } from \"lively.morphic/components/canvas.js\";\nimport { show } from \"lively.morphic/index.js\";\nimport { loadObjectFromPartsbinFolder } from \"lively.morphic/partsbin.js\";\nimport { rect, pt } from \"lively.graphics/index.js\";\n\n\nexport default class Sketch extends Canvas {\n  static get properties() {\n    return {\n      strokes: {defaultValue: []},\n      preserveContents: {defaultValue: false},\n    }\n  }\n\n  get isSketch() { return true; }\n\n  restoreContent(old_canvas) {\n    this.redraw();\n  }\n  \n  redraw() {\n    const ctx = this.context;\n    if (!ctx) return;\n    this.clear();\n    ctx.save();\n    ctx.globalCompositeOperation = \"darken\";\n    ctx.lineJoin = \"round\";\n    ctx.lineCap = \"round\";\n    for (let stroke of this.strokes) {\n      const {color, width, vertices} = stroke;\n      ctx.beginPath();\n      if (width) ctx.lineWidth = width;\n      if (color) ctx.strokeStyle = color;\n      let [x, y] = vertices;\n      ctx.moveTo(x, y);\n      for (let i = 0; i < vertices.length; i += 2) {\n        x = vertices[i],\n        y = vertices[i + 1];\n        ctx.lineTo(x, y);\n      }\n      ctx.stroke();\n    }\n    ctx.restore();\n  }\n\n  strokeBounds() {\n    let minx = 1000000000,\n        maxx = -1000000000,\n        miny = 1000000000,\n        maxy = -1000000000;\n    for (let stroke of this.strokes) {\n      const {width, vertices} = stroke;\n      const w = width / 2;\n      for (let i = 0; i < vertices.length; i += 2) {\n        const x = vertices[i];\n        const y = vertices[i + 1];\n        if (x - w < minx) minx = x - w;\n        if (x + w > maxx) maxx = x + w;\n        if (y - w < miny) miny = y - w;\n        if (y + w > maxy) maxy = y + w;\n      }\n    }\n    return rect(minx, miny, maxx - minx, maxy - miny).expandBy(1);\n  }\n  \n  moveStrokes({x, y}) {\n    for (let stroke of this.strokes) {\n      const {vertices} = stroke;\n      for (let i = 0; i < vertices.length; i += 2) {\n        vertices[i    ] += x;\n        vertices[i + 1] += y;\n      }\n    }    \n  }\n\n  trimNonTransparent(){\n    let bounds = this.strokeBounds(),\n        offset = bounds.topLeft(),\n        extent = bounds.extent();\n    if (!offset.equals(pt(0,0))) {\n      this.moveStrokes(offset.negated());\n      this.position = this.position.addPt(offset);\n    }\n    if (!extent.equals(this.extent)) {\n      this.extent = extent;     // causes redraw\n    } else {\n      this.redraw();\n    }\n  }\n\n  onExtentChanged() {\n    this.__canvas_init__ = () => this.redraw();\n  }\n\n  renderPreview(opts) {\n    this.__canvas_init__ = () => this.redraw();\n    return super.renderPreview(opts);\n  }\n  \n  menuItems() {\n    const items = super.menuItems();\n    items.push(['Open sketching palette', () => this.edit()]);\n    return items;\n  }\n\n  edit() {\n    this.aquirePalette().then((palette) => palette.edit(this));\n  }\n\n  async aquirePalette() {\n    let palette = this.world().submorphs.find((m) => m.isSketchingPalette);\n    if (palette) {\n      palette.uncollapse();\n    } else {\n      palette = await loadObjectFromPartsbinFolder(\"SketchingPalette\");\n      palette.openInWorld();\n    }\n    return palette;\n  }\n}\n\n"
      }
    }
  },
  "preview": "data:image/png;base64,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"
}