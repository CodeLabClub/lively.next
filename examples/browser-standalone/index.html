<!DOCTYPE html>
<html>
  <head>
    <title>lively.modules browser standalone example</title>
  </head>
  <body>
    <script src="../../node_modules/babel-core/browser.js"></script>
    <script src="../../node_modules/systemjs/dist/system.src.js"></script>
    <script src="../../dist/lively.modules.js"></script>
    
    <script> // helper
      function log(msg) {
        console.log(msg);
        var logEl = document.querySelector("#log");
        if (logEl) {
          var stringified = typeof msg === "object" ? JSON.stringify(msg, null, 2) : String(msg);
          logEl.insertAdjacentHTML("beforeend", '<li><pre>' + stringified + '</li>');
        }
      }
    </script>

    <script>
      // 1. Load the package at examples/browser-standalone/test-package/
      // and import its main file
      lively.modules.importPackage("test-package")
        .then(module => log("Successfully loaded test-package: " + JSON.stringify(module)))
        .then(() => {
          // 2. The package will be automatically instrumented, allowing to
          // inspect the runtime state of its modules and evaluating stuff inside
          // it:
          var expr = "x + 3";
          lively.modules.runEval(expr, {targetModule: "test-package"})
            .then(result => log(`evaluating ${expr}, result: ${JSON.stringify(result, null, 2)}`))
        })
        .catch(err => {
          if (err.originalErr) log(err.originalErr.stack);
          log(err.stack || err);
        })

      function systemConfPrint() {
        var S = System;
        var json = {
          baseURL: S.baseURL,
          transpiler: S.transpiler,
          defaultJSExtensions: S.defaultJSExtensions,
          map: S.map,
          meta: S.meta,
          packages: S.packages,
          paths: S.paths,
          packageConfigPaths: S.packageConfigPaths,
        }
        return JSON.stringify(json, null, 2);
      }

      function log(msg) {
        console.log(msg);
        var logEl = document.querySelector("#log");
        if (logEl) {
          var stringified = typeof msg === "object" ? JSON.stringify(msg, null, 2) : String(msg);
          logEl.insertAdjacentHTML("beforeend", '<li><pre>' + stringified + '</li>');
        }
      }

    </script>
  </body>
</html>
