<!DOCTYPE html>
<html>
  <head>
    <title>lively.morphic example 1</title>
  </head>
  <body style="margin: 0;">
    <div id="lively-world"></div>
    <!--<div style="position: absolute; left: 30px; top: 50px; background-color: yellow;">-->
    <!--  <div style="position: relative; left: 30px; top: 50px;  background-color: blue;">-->
    <!--    <div id="lively-world"></div>-->
    <!--  </div>-->
    <!--</div>-->
    <script src="../../node_modules/pepjs/dist/pep.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/fetch/1.0.0/fetch.js"></script>
    <script src="/node_modules/lively.modules/node_modules/systemjs/dist/system.src.js"></script>
    <script src="/node_modules/lively.modules/dist/lively.modules.js"></script>
    <script>
      // Promise.resolve()
      //   // FIXME!!!
      //   .then(function () { return lively.modules.importPackage('http://localhost:9001/node_modules/lively-system-interface/'); })
      //   .then(function () { return lively.modules.importPackage('.'); })
      //   .then(function() { console.log("loaded"); })
      //   .catch(function(err) { console.error(err); })

      Promise.resolve()
        // FIXME!!!
        .then(bootstrapLivelySystem)
        .then(function() { console.log("3. loading lively.morphic"); })
        .then(function () { return lively.modules.importPackage('.'); })
        .then(function() { console.log("... lively.morphic loaded"); })
        .catch(function(err) { console.error(err); })


      function bootstrapLivelySystem() {
        // for loading an instrumented version of the packages comprising the lively.system
        return Promise.resolve()
        .then(function() { console.log("1. loading initial system so we can bootstrap..."); })
        .then(function () { return lively.modules.importPackage('http://localhost:9001/node_modules/lively-system-interface/'); })
        .then(function() { console.log("... done!"); })

        .then(function() { console.log("2. preparing to bootstrap..."); })

        .then(function () { return lively.modules.removePackage('http://localhost:9001/node_modules/lively-modules/'); })
        .then(function() { return lively.modules.importPackage("http://localhost:9001/node_modules/lively-system-interface/node_modules/lively.lang"); }).then(function(m) {
          delete m._prevLivelyGlobal
          // lively.lang = m;
        })
        .then(function() { console.log("... lively.lang loaded..."); })
        .then(function() { return lively.modules.importPackage("http://localhost:9001/node_modules/lively-system-interface/node_modules/lively.ast"); }).then(function(m) {
          lively.ast = m;
        })
        .then(function() { console.log("... lively.ast loaded..."); })
        .then(function() { return lively.modules.importPackage("http://localhost:9001/node_modules/lively-system-interface/node_modules/lively.vm"); }).then(function(m) {
          lively.vm = m;
          lively.lang.VM = m;
        })
        .then(function() { console.log("... lively.vm loaded..."); })
        .then(function() { return lively.modules.importPackage("http://localhost:9001/node_modules/lively-system-interface/node_modules/lively.modules"); }).then(function(m) {
          lively.modules = m;
          lively.modules.unwrapModuleLoad(); lively.modules.wrapModuleLoad();
        })
        .then(function() { console.log("... lively.modules loaded..."); })
        .then(function() { console.log("...lively.system bootstrapped!"); })
        .catch(function(err) { console.error(err); })
      }
    </script>
  </body>
</html>
